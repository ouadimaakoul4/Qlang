<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QLang ‚Äî Interrogez l'Univers</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; }
        button { padding: 10px 20px; }
        #response { border: 1px solid #ddd; padding: 20px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>QLang v1.2 ‚Äî Traducteur Cosmique</h1>
    <p>Posez une question √† l'univers, et obtenez une r√©ponse fond√©e sur ses lois fondamentales.</p>
    <input type="text" id="question" placeholder="Ex: L'information est-elle plus fondamentale que la mati√®re ?">
    <button onclick="askQLang()">Interroger l'Univers</button>
    <div id="response"></div>

    <script>
        let pyodide;
        let pyodideLoading = false;
        let pyodideLoaded = false;

        async function loadPyodideAndPackages() {
            pyodideLoading = true;
            try {
                pyodide = await loadPyodide();
                await pyodide.loadPackage('micropip');
                // Charger les packages n√©cessaires
                await pyodide.runPythonAsync(`
                    import micropip
                    await micropip.install('sympy')
                `);
                
                // Charger le code QLang
                await pyodide.runPython(`
import sympy as sp

lois = {
    "thermo_2": {
        "nom": "2e loi de la thermodynamique",
        "√©nonc√©": "ŒîS ‚â• 0 dans un syst√®me isol√©",
        "√©nonc√©_latex": r"\\\\Delta S \\\\geq 0",
        "cons√©quences": ["fl√®che du temps", "augmentation de l'entropie", "limite √† la complexit√© perp√©tuelle"],
        "domaine": ["thermodynamique", "entropie", "syst√®mes"],
        "sources": ["Carnot, Clausius, Boltzmann (19e si√®cle)"],
        "confiance_intrins√®que": 1.0
    },
    "bekenstein": {
        "nom": "Limite de Bekenstein",
        "√©nonc√©": "Densit√© d'information maximale ~ A / (4 l_Pl¬≤)",
        "√©nonc√©_latex": r"I \\\\leq \\\\frac{2 \\\\pi E R}{\\\\hbar c \\\\ln 2}",
        "cons√©quences": ["borne sup√©rieure √† l'information dans un volume", "lien gravit√©-information", "principe holographique"],
        "domaine": ["information", "gravit√©", "cosmologie"],
        "sources": ["Bekenstein, 1973"],
        "confiance_intrins√®que": 0.95
    },
    "landauer": {
        "nom": "Principe de Landauer",
        "√©nonc√©": "Co√ªt minimal de kT ln(2) par bit effac√©",
        "√©nonc√©_latex": r"E \\\\geq k T \\\\ln 2",
        "cons√©quences": ["co√ªt thermodynamique du calcul", "limite √† la complexit√© computationnelle"],
        "domaine": ["information", "thermodynamique", "computation"],
        "sources": ["Landauer, 1961"],
        "confiance_intrins√®que": 0.98
    },
    "lcdm": {
        "nom": "Mod√®le ŒõCDM",
        "√©nonc√©": "Expansion acc√©l√©r√©e de l'univers",
        "√©nonc√©_latex": r"\\\\Lambda > 0",
        "cons√©quences": ["dilution des gradients d'√©nergie", "mort thermique finale"],
        "domaine": ["cosmologie", "expansion", "√©nergie"],
        "sources": ["Riess et al., 1998; Perlmutter et al., 1999"],
        "confiance_intrins√®que": 0.92
    },
    "dissipatifs": {
        "nom": "Th√©orie des syst√®mes dissipatifs (Prigogine)",
        "√©nonc√©": "√âmergence de complexit√© loin de l'√©quilibre",
        "√©nonc√©_latex": r"dS = d_e S + d_i S, \\\\, d_i S > 0",
        "cons√©quences": ["auto-organisation", "structures stables temporaires", "fen√™tre temporelle de complexit√©"],
        "domaine": ["complexit√©", "√©mergence", "syst√®mes"],
        "sources": ["Nicolis & Prigogine, 1977"],
        "confiance_intrins√®que": 0.85
    },
    "selection_cosmique": {
        "nom": "Principe de s√©lection cosmique (Tegmark)",
        "√©nonc√©": "Seules les structures math√©matiquement coh√©rentes peuvent exister de fa√ßon stable",
        "√©nonc√©_latex": None,
        "cons√©quences": ["√©limination des incoh√©rences par interf√©rence destructive", "univers auto-s√©lectionnant"],
        "domaine": ["cosmologie", "math√©matiques", "ontologie"],
        "sources": ["Tegmark, 1998"],
        "confiance_intrins√®que": 0.75
    }
}

questions_types = {
    "fondamentalite_info": {
        "mots_cles": ["information", "fondamentale", "mati√®re", "bit", "primitive"],
        "lois": ["bekenstein", "landauer", "selection_cosmique", "thermo_2"],
        "synthese_template": "L'information et la mati√®re sont intriqu√©es, mais l'information semble **plus primitive** dans la hi√©rarchie cosmique. La mati√®re sans information est un √©tat indiff√©renci√© (entropie maximale). L'information sans mati√®re est instable (co√ªt √©nerg√©tique). Cependant, dans les r√©gimes extr√™mes, l'information pr√©c√®de la g√©om√©trie (principe holographique). Ainsi, l'information d√©finit **ce qui peut exister**, tandis que la mati√®re fournit le cadre."
    },
    "origine_lois": {
        "mots_cles": ["lois", "chaos", "ordre", "pourquoi", "fondement"],
        "lois": ["dissipatifs", "thermo_2", "selection_cosmique"],
        "synthese_template": "Le chaos absolu est instable. Les syst√®mes √©voluent vers des √©tats sym√©triques ou auto-organis√©s. Seules les structures coh√©rentes persistent. Les lois sont la trace de ce qui a surv√©cu."
    },
    "direction_temps": {
        "mots_cles": ["temps", "direction", "sens", "fl√®che"],
        "lois": ["thermo_2"],
        "synthese_template": "Le temps a une direction parce que l'entropie augmente. L'univers a commenc√© dans un √©tat de basse entropie, et √©volue vers le d√©sordre maximal."
    }
}

def mapper_question(question):
    question_lower = question.lower()
    for q_type, data in questions_types.items():
        if any(mot in question_lower for mot in data["mots_cles"]):
            return q_type, data["lois"]
    return None, []

def generer_reponse(question):
    type_question, lois_invoquees = mapper_question(question)
    if not lois_invoquees:
        return "### üîÆ R√©ponse QLang v1.2\\\\n\\\\n**Question** : {} \\\\n\\\\n**Synth√®se** : Aucune loi pertinente trouv√©e. Reformulez avec des termes comme 'entropie', 'information', 'temps', etc.\\\\n\\\\n**Confiance** : ‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ\\\\n**Lois invoqu√©es** : []".format(question)
    
    markdown = "### üîÆ R√©ponse QLang v1.2\\\\n\\\\n**Question** : {}\\\\n\\\\n**Synth√®se** : \\\\n".format(question)
    
    if type_question in questions_types:
        markdown += questions_types[type_question]["synthese_template"] + "\\\\n"
    else:
        markdown += "Synth√®se g√©n√©rique bas√©e sur les lois invoqu√©es.\\\\n"
    
    markdown += "Nuances : Ces lois interagissent pour limiter l'information sans substrat mat√©riel, mais sp√©culent sur des r√©gimes holographiques en d√©bat.\\\\n"
    
    markdown += "\\\\n**Lois invoqu√©es** :\\\\n"
    confiance_moyenne = 0
    for loi_key in lois_invoquees:
        loi = lois[loi_key]
        equation_str = f" √âquation : ${loi['√©nonc√©_latex']}$." if loi['√©nonc√©_latex'] else ""
        markdown += f"- **{loi['nom']}** : {loi['√©nonc√©']}. Cons√©quences: {', '.join(loi['cons√©quences'])}.{equation_str}\\\\n"
        confiance_moyenne += loi["confiance_intrins√®que"]
    
    confiance_moyenne /= len(lois_invoquees)
    etoiles = "‚òÖ" * int(confiance_moyenne * 5) + "‚òÜ" * (5 - int(confiance_moyenne * 5))
    markdown += f"\\\\n**Confiance** : {etoiles} ({confiance_moyenne:.2f})"
    
    return markdown
                `);
                pyodideLoaded = true;
                console.log("Pyodide charg√© avec succ√®s !");
            } catch (error) {
                console.error("Erreur lors du chargement de Pyodide:", error);
            } finally {
                pyodideLoading = false;
            }
        }

        async function askQLang() {
            const question = document.getElementById('question').value;
            const responseDiv = document.getElementById('response');
            
            if (!question) {
                responseDiv.innerHTML = "<p>Veuillez poser une question.</p>";
                return;
            }

            // Afficher un message de chargement
            responseDiv.innerHTML = "<p>üîÆ L'univers r√©fl√©chit...</p>";

            try {
                // Charger Pyodide si n√©cessaire
                if (!pyodideLoaded && !pyodideLoading) {
                    await loadPyodideAndPackages();
                } else if (pyodideLoading) {
                    responseDiv.innerHTML = "<p>Chargement en cours... Veuillez patienter.</p>";
                    // Attendre que le chargement soit termin√©
                    while (pyodideLoading) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                }

                if (!pyodide) {
                    throw new Error("Pyodide n'a pas pu √™tre charg√©");
                }

                // Nettoyer la question pour √©viter les probl√®mes d'√©chappement
                const questionSafe = question.replace(/'/g, "\\\\'").replace(/"/g, '\\\\"');
                
                // Ex√©cuter Python
                const response = await pyodide.runPython(\`generer_reponse('\${questionSafe}')\`);
                
                // Convertir le markdown en HTML
                const htmlResponse = marked.parse(response.replace(/\\\\n/g, '\n'));
                responseDiv.innerHTML = htmlResponse;
                
                // Mettre √† jour MathJax pour les √©quations
                if (window.MathJax) {
                    MathJax.typeset();
                }
                
            } catch (error) {
                console.error("Erreur:", error);
                responseDiv.innerHTML = \`<p style="color: red;">Erreur: \${error.message}</p>\`;
            }
        }

        // Charger Pyodide au d√©marrage
        window.addEventListener('load', function() {
            loadPyodideAndPackages();
        });

        // Permettre d'utiliser la touche Entr√©e
        document.getElementById('question').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                askQLang();
            }
        });
    </script>
</body>
</html>
